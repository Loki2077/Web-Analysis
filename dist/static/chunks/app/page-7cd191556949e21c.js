(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8447:(e,r,t)=>{Promise.resolve().then(t.bind(t,9862))},9862:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var n=t(5155),l=t(8974),s=t(2115),i=t(832),o=t.n(i),a=t(3408),d=t.n(a),c=t(9696),x=t.n(c);o().extend(d()),o().extend(x());let p=e=>{let{selectedDomain:r,onSelectDomain:t,domainEventCounts:l,domainOnlineUserCounts:s,domainList:i,userList:o,eventList:a}=e;return(0,n.jsxs)("div",{style:{flexGrow:1,overflow:"hidden"},children:[" ",0===i.length?(0,n.jsx)("p",{children:"暂无域名数据。"}):(0,n.jsxs)("ul",{style:{maxHeight:"100%",overflowY:"auto",paddingRight:"15px"},children:[" ",i.map(e=>{let o=l.get(e.domain)||0,a=s.get(e.domain)||0;return(0,n.jsx)("li",{style:{cursor:"pointer",fontWeight:e.domain===r?"bold":"normal",padding:"12px 16px",marginBottom:"10px",marginTop:e===i[0]?"10px":"0",border:e.domain===r?"2px solid #ffcce0":"2px solid #f8f8f8",borderRadius:"16px",width:"100%",backgroundColor:e.domain===r?"rgba(255, 204, 224, 0.08)":"#fff",transition:"all 0.2s ease"},onClick:()=>t(e.domain),onMouseEnter:t=>{e.domain!==r&&(t.currentTarget.style.backgroundColor="rgba(255, 204, 224, 0.04)",t.currentTarget.style.borderColor="#ffcce0")},onMouseLeave:t=>{e.domain!==r&&(t.currentTarget.style.backgroundColor="#fff",t.currentTarget.style.borderColor="#f8f8f8")},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[" ",(0,n.jsxs)("span",{style:{flexGrow:1,flexShrink:1,flexBasis:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"10px"},children:[" ",(0,n.jsx)("strong",{children:e.domain})]}),(0,n.jsxs)("span",{style:{fontSize:"0.85em",color:"#ffb3d1",display:"flex",alignItems:"center",marginRight:"8px",flexShrink:0,backgroundColor:"rgba(255, 179, 209, 0.08)",padding:"4px 8px",borderRadius:"12px",fontWeight:"500"},children:[" ","\uD83C\uDF1F ",a]}),(0,n.jsxs)("span",{style:{fontSize:"0.85em",color:"#a8d8ea",display:"flex",alignItems:"center",flexShrink:0,backgroundColor:"rgba(168, 216, 234, 0.08)",padding:"4px 8px",borderRadius:"12px",fontWeight:"500"},children:[" ","✨ ",o]})]})},e._id)})]})]})},g=e=>{let{userList:r,selectedDomain:t,onOnlineUserCountChange:l,onSelectFingerprint:i}=e,[a,d]=(0,s.useState)(null),c=(0,s.useMemo)(()=>{let e=[...r];return t&&(e=e.filter(e=>e.domain===t)),e},[r,t]);(0,s.useEffect)(()=>{let e=new Map,r=o()();c.forEach(t=>{if(t.lastSeen&&t.domain){let n=o()(t.lastSeen);if(3e5>r.diff(n,"millisecond")){let r=e.get(t.domain)||0;e.set(t.domain,r+1)}}}),l&&e.forEach((e,r)=>{l(r,e)})},[c,l]);let x=(0,s.useCallback)(e=>{let r=a===e?null:e;d(r),i&&i(r)},[a,i]);return(0,n.jsxs)("div",{style:{flexGrow:1,overflow:"auto",display:"flex",flexDirection:"column"},children:[" ",0===c.length?(0,n.jsx)("p",{children:"没有找到相关的用户。"}):(0,n.jsxs)("ul",{style:{flexGrow:1,overflowY:"auto"},children:[" ",c.map((e,r)=>(0,n.jsxs)("li",{onClick:()=>x(e.fingerprint),style:{cursor:"pointer",fontWeight:e.fingerprint===a?"bold":"normal",backgroundColor:e.fingerprint===a?"rgba(255, 204, 224, 0.08)":"#fff",padding:"12px 16px",marginBottom:"10px",marginTop:0===r?"10px":"0",borderRadius:"16px",display:"flex",justifyContent:"space-between",alignItems:"center",border:e.fingerprint===a?"2px solid #ffcce0":"2px solid #f8f8f8",transition:"all 0.2s ease"},onMouseEnter:r=>{e.fingerprint!==a&&(r.currentTarget.style.backgroundColor="rgba(255, 204, 224, 0.04)",r.currentTarget.style.borderColor="#ffcce0")},onMouseLeave:r=>{e.fingerprint!==a&&(r.currentTarget.style.backgroundColor="#fff",r.currentTarget.style.borderColor="#f8f8f8")},children:[(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)("span",{style:{fontSize:"0.8em",color:"#a8d8ea",backgroundColor:"rgba(168, 216, 234, 0.08)",padding:"2px 6px",borderRadius:"8px",fontWeight:"500"},children:"\uD83C\uDF10"}),(0,n.jsx)("strong",{style:{color:"#333"},children:e.ip||"N/A"})," "]}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)("span",{style:{fontSize:"0.8em",color:"#98d982",backgroundColor:"rgba(152, 217, 130, 0.1)",padding:"2px 6px",borderRadius:"8px",fontWeight:"500"},children:"⏰"}),(0,n.jsx)("span",{style:{fontSize:"0.85em",color:"#666"},children:e.lastSeen?o()(e.lastSeen).format("MM-DD HH:mm"):"N/A"})]})]}),(0,n.jsxs)("div",{style:{backgroundColor:"#ffb3d1",color:"#fff",padding:"6px 12px",borderRadius:"20px",fontSize:"0.75em",fontWeight:"600",fontFamily:"monospace",boxShadow:"0 2px 6px rgba(255, 204, 224, 0.12)",display:"flex",alignItems:"center",gap:"4px"},children:[(0,n.jsx)("span",{children:"\uD83D\uDD10"}),e.fingerprint?e.fingerprint.substring(0,8):"N/A"]})]},e._id))]})]})};var f=t(9911);let u=e=>{let{message:r,type:t,duration:l=3e3,onClose:i}=e,[o,a]=(0,s.useState)(!0),[d,c]=(0,s.useState)(!1);(0,s.useEffect)(()=>{c(!0);let e=setTimeout(()=>{x()},l);return()=>clearTimeout(e)},[l]);let x=()=>{c(!1),setTimeout(()=>{a(!1),i()},300)};return o?(0,n.jsxs)("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:9999,minWidth:"300px",maxWidth:"400px",padding:"16px 20px",background:(()=>{switch(t){case"success":default:return"linear-gradient(135deg, #E8F5E8 0%, #C8E6C9 100%)";case"error":return"linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%)";case"warning":return"linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%)"}})(),border:"2px solid ".concat((()=>{switch(t){case"success":default:return"#4CAF50";case"error":return"#F44336";case"warning":return"#FF9800"}})()),borderRadius:"20px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",gap:"12px",fontFamily:"Arial, sans-serif",fontSize:"14px",fontWeight:"500",color:"#333",transform:d?"translateX(0)":"translateX(100%)",opacity:+!!d,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",backdropFilter:"blur(10px)"},children:[(0,n.jsx)("div",{style:{flexShrink:0},children:(()=>{switch(t){case"success":default:return(0,n.jsx)(f.A7C,{style:{color:"#4CAF50",fontSize:"1.2em"}});case"error":return(0,n.jsx)(f.TNq,{style:{color:"#F44336",fontSize:"1.2em"}});case"warning":return(0,n.jsx)(f.TNq,{style:{color:"#FF9800",fontSize:"1.2em"}})}})()}),(0,n.jsx)("div",{style:{flex:1,lineHeight:"1.4"},children:r}),(0,n.jsx)("button",{onClick:x,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s ease",color:"#666"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:(0,n.jsx)(f.QCr,{style:{fontSize:"0.9em"}})})]}):null},m=()=>{let[e,r]=(0,s.useState)([]),t=e=>{r(r=>r.filter(r=>r.id!==e))};return{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,l=Date.now().toString();r(r=>[...r,{id:l,message:e,type:t,duration:n}])},ToastContainer:()=>(0,n.jsx)(n.Fragment,{children:e.map(e=>(0,n.jsx)(u,{message:e.message,type:e.type,duration:e.duration,onClose:()=>t(e.id)},e.id))})}},h=e=>{let{user:r,details:t}=e,{showToast:l,ToastContainer:i}=m(),[a,d]=(0,s.useState)(!1),[c,x]=(0,s.useState)(""),p=(null==r?void 0:r.ip)||"N/A",g=(null==r?void 0:r.fingerprint)||"N/A",u=t.length>0?t[0]:null,h=null==u?void 0:u.location,y="N/A";if(h){if("string"==typeof h)y=h;else if("object"==typeof h){var b,j;h.displayName?y=h.displayName:h.placeName?y=h.placeName:(null==(b=h.latitude)?void 0:b.$numberDouble)!==void 0&&(null==(j=h.longitude)?void 0:j.$numberDouble)!==void 0&&(y="".concat(h.latitude.$numberDouble,", ").concat(h.longitude.$numberDouble))}}let v=null==u?void 0:u.browser,C=v?"".concat(v.name||"Unknown"," ").concat(v.version||"").trim():"N/A",k=(null==u?void 0:u.os)||"N/A",S=(null==u?void 0:u.language)||"N/A",w=(null==u?void 0:u.timezone)||"N/A",N=(null==u?void 0:u.referrer)||"N/A",R=(null==u?void 0:u.notes)||"",D=(null==r?void 0:r.createdAt)?o()(r.createdAt).format("YYYY-MM-DD HH:mm"):"N/A",E=(null==r?void 0:r.lastSeen)?o()(r.lastSeen).format("YYYY-MM-DD HH:mm"):"N/A";return(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"20px",minWidth:"520px",maxWidth:"645px"},children:[" ",r?(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:[(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",fontSize:"1em",fontWeight:"bold",color:"var(--text-color)"},children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",fontSize:"1.5em",fontWeight:"bold",color:"var(--text-color)"},children:[(0,n.jsx)(f.x$1,{style:{marginLeft:"8px",fontSize:"1em"}})," ",(0,n.jsx)("strong",{children:"备注:"})," ",a?(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",flexGrow:1,marginLeft:"10px"},children:[(0,n.jsx)("input",{type:"text",value:c,onChange:e=>x(e.target.value),style:{flexGrow:1,padding:"12px 16px",marginRight:"8px",borderRadius:"12px",border:"2px solid #ffcce0",fontSize:"14px",outline:"none",transition:"all 0.2s ease",backgroundColor:"#fff",boxShadow:"0 2px 8px rgba(255, 204, 224, 0.1)"},onFocus:e=>{e.target.style.borderColor="#ffb3d1",e.target.style.boxShadow="0 4px 12px rgba(255, 179, 209, 0.2)"},onBlur:e=>{e.target.style.borderColor="#ffcce0",e.target.style.boxShadow="0 2px 8px rgba(255, 204, 224, 0.1)"}}),(0,n.jsx)("button",{onClick:async()=>{if(!(null==u?void 0:u._id)){console.error("Cannot save notes: Detail _id is missing."),l("保存失败: 缺少用户详情ID \uD83E\uDD7A","error");return}try{let e=await fetch("/api/update-notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({detailId:u._id,notes:c})}),r=await e.json();r.success?(console.log("Notes updated successfully:",r),d(!1),l("备注保存成功！ ✨","success")):(console.error("Failed to update notes:",r.message),l("保存失败: ".concat(r.message," \uD83D\uDE22"),"error"))}catch(e){console.error("Error saving notes:",e),l("保存过程中发生错误 \uD83D\uDE35","error")}},style:{padding:"8px 16px",borderRadius:"20px",backgroundColor:"transparent",color:"#ffb3d1",border:"2px solid #ffcce0",cursor:"pointer",fontSize:"14px",fontWeight:"500",boxShadow:"0 2px 8px rgba(255, 204, 224, 0.2)",transition:"all 0.2s ease"},onMouseEnter:e=>{let r=e.target;r.style.backgroundColor="#ffb3d1",r.style.color="white",r.style.transform="translateY(-1px)",r.style.boxShadow="0 4px 12px rgba(255, 179, 209, 0.3)"},onMouseLeave:e=>{let r=e.target;r.style.backgroundColor="transparent",r.style.color="#ffb3d1",r.style.transform="translateY(0)",r.style.boxShadow="0 2px 8px rgba(255, 204, 224, 0.2)"},children:"\uD83D\uDCBE 保存"}),(0,n.jsx)("button",{onClick:()=>{d(!1),x(R)},style:{padding:"8px 16px",borderRadius:"20px",backgroundColor:"transparent",color:"#b8b8b8",border:"2px solid #b8b8b8",cursor:"pointer",marginLeft:"8px",fontSize:"14px",fontWeight:"500",boxShadow:"0 2px 8px rgba(184, 184, 184, 0.2)",transition:"all 0.2s ease"},onMouseEnter:e=>{let r=e.target;r.style.backgroundColor="#b8b8b8",r.style.color="white",r.style.transform="translateY(-1px)",r.style.boxShadow="0 4px 12px rgba(184, 184, 184, 0.3)"},onMouseLeave:e=>{let r=e.target;r.style.backgroundColor="transparent",r.style.color="#b8b8b8",r.style.transform="translateY(0)",r.style.boxShadow="0 2px 8px rgba(184, 184, 184, 0.2)"},children:"❌ 取消"})]}):(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)("div",{style:{marginLeft:"10px"},children:R}),u&&(0,n.jsx)(f.uO9,{style:{width:"18px",cursor:"pointer",color:"#ffb3d1",marginLeft:"8px",fontSize:"18px",transition:"all 0.2s ease"},title:"✏️ 编辑备注",onMouseEnter:e=>{let r=e.target;r.style.backgroundColor="rgba(255, 179, 209, 0.1)",r.style.transform="scale(1.1)"},onMouseLeave:e=>{let r=e.target;r.style.backgroundColor="transparent",r.style.transform="scale(1)"},onClick:()=>{d(!0),x(R)}})]})]})}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px"},children:[(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff"},children:[(0,n.jsx)("strong",{style:{color:"var(--text-color)"},children:"IP 地址:"}),(0,n.jsx)("div",{children:p})]}),(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff"},children:[(0,n.jsx)("strong",{style:{color:"var(--text-color)"},children:"用户指纹:"}),(0,n.jsx)("div",{children:g})]})]}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"15px"},children:[" ",(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff",gridColumn:"span 2"},children:[" ",(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",color:"var(--cute-pink)"},children:[" ",(0,n.jsx)(f.f35,{style:{marginRight:"8px",fontSize:"1.2em"}}),(0,n.jsx)("strong",{children:"位置"})]}),(0,n.jsx)("div",{children:y})]})]})," ",(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px"},children:[" ",(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",color:"var(--cute-pink)"},children:[" ",(0,n.jsx)(f.Wjq,{style:{marginRight:"8px",fontSize:"1.2em"}}),(0,n.jsx)("strong",{children:"浏览器"})]}),(0,n.jsx)("div",{children:C})]}),(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",color:"var(--cute-pink)"},children:[" ",(0,n.jsx)(f.Wqt,{style:{marginRight:"8px",fontSize:"1.2em"}}),(0,n.jsx)("strong",{children:"系统"})]}),(0,n.jsx)("div",{children:k})]}),(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",color:"var(--cute-pink)"},children:[" ",(0,n.jsx)(f.gqt,{style:{marginRight:"8px",fontSize:"1.2em"}}),(0,n.jsx)("strong",{children:"语言"})]}),(0,n.jsx)("div",{children:S})]}),(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",color:"var(--cute-pink)"},children:[" ",(0,n.jsx)(f.w_X,{style:{marginRight:"8px",fontSize:"1.2em"}}),(0,n.jsx)("strong",{children:"时区"})]}),(0,n.jsx)("div",{children:w})]}),(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",color:"var(--cute-pink)"},children:[" ",(0,n.jsx)(f.w_X,{style:{marginRight:"8px",fontSize:"1.2em"}})," ",(0,n.jsx)("strong",{children:"访问时间"})]}),(0,n.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,n.jsx)("strong",{style:{color:"#666"},children:"首次:"})," ",D]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{style:{color:"#666"},children:"最后:"})," ",E]})]}),(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",color:"var(--cute-pink)"},children:[" ",(0,n.jsx)(f.w_X,{style:{marginRight:"8px",fontSize:"1.2em"}})," ",(0,n.jsx)("strong",{children:"时区"})]}),(0,n.jsx)("div",{children:w})]})]})," ",(0,n.jsxs)("div",{className:"panel",style:{padding:"15px",borderRadius:"8px",backgroundColor:"#fff",gridColumn:"span 2"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px",color:"var(--cute-pink)"},children:[" ",(0,n.jsx)(f.AnD,{style:{marginRight:"8px",fontSize:"1.2em"}}),(0,n.jsx)("strong",{children:"来源网站"})]}),(0,n.jsx)("div",{style:{wordBreak:"break-all"},children:N})]})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{style:{padding:"15px"},children:"请选择一个用户查看详情。"})," "]}),(0,n.jsx)(i,{})]})},y=e=>{let{events:r}=e,t=s.useMemo(()=>{let e=[...r];return e.sort((e,r)=>{let t=new Date(e.timestamp).getTime();return new Date(r.timestamp).getTime()-t}),e},[r]),l=(e,r)=>{if(!r)return(0,n.jsx)("div",{children:"N/A"});switch(e){case"view":return(0,n.jsxs)("div",{style:{fontSize:"0.9em",color:"#333"},children:[r.pageTitle&&(0,n.jsxs)("div",{style:{marginBottom:"5px"},children:[(0,n.jsx)("strong",{children:"Page Title:"})," ",r.pageTitle]}),r.pageUrl&&(0,n.jsxs)("div",{style:{marginBottom:"5px"},children:[(0,n.jsx)("strong",{children:"Page URL:"})," ",(0,n.jsx)("a",{href:r.pageUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"#007bff",textDecoration:"none"},children:r.pageUrl})]}),r.screenResolution&&(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Screen Resolution:"})," ",r.screenResolution]})]});case"click":return(0,n.jsxs)("div",{style:{fontSize:"0.9em",color:"#333"},children:[r.elementType&&(0,n.jsxs)("div",{style:{marginBottom:"5px"},children:[(0,n.jsx)("strong",{children:"Element Type:"})," ",r.elementType]}),r.clickedContent&&(0,n.jsxs)("div",{style:{marginBottom:"5px"},children:[(0,n.jsx)("strong",{children:"Clicked Content:"})," ",r.clickedContent]}),r.page&&(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Page:"})," ",r.page]})]});case"heartbeat":return(0,n.jsx)("div",{style:{fontSize:"0.9em",color:"#555"},children:"Heartbeat event."});case"console":return(0,n.jsxs)("div",{style:{fontSize:"0.9em",color:"#dc3545"},children:[r.message&&(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Message:"})," ",r.message]}),r.level&&(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Level:"})," ",r.level]})]});default:return(0,n.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:JSON.stringify(r,null,2)})}},i=e=>{switch(e.toLowerCase()){case"view":return(0,n.jsx)("div",{style:{backgroundColor:"#e9f5ff",borderRadius:"4px",padding:"3px",display:"flex",alignItems:"center"},children:(0,n.jsx)(f.Ny1,{size:14,style:{color:"#007bff"}})});case"click":return(0,n.jsx)("div",{style:{backgroundColor:"#eaf7ee",borderRadius:"4px",padding:"3px",display:"flex",alignItems:"center"},children:(0,n.jsx)(f.ugv,{size:14,style:{color:"#28a745"}})});case"console":case"heartbeat":return(0,n.jsx)(f.szJ,{size:14,style:{marginRight:"5px",color:"#dc3545"}});default:return null}};return(0,n.jsxs)("div",{className:"panel",style:{display:"flex",flexDirection:"column",height:"100%"},children:[" ",(0,n.jsx)("div",{style:{flexGrow:1,overflow:"hidden"},children:0===r.length?(0,n.jsx)("p",{children:"没有找到相关的事件。"}):(0,n.jsx)("ul",{style:{maxHeight:"100%",overflowY:"auto",paddingRight:"15px"},children:t.map(e=>(0,n.jsxs)("li",{style:{marginBottom:"25px",padding:"10px",borderLeft:"2px solid #ffb6c1",backgroundColor:"#f8f8f8",borderRadius:"4px",overflowX:"hidden",display:"flex",flexDirection:"column"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",fontSize:"0.9em",color:"#555",marginBottom:"8px"},children:[" ",i(e.type)," ",i(e.type)&&(0,n.jsx)("span",{style:{marginLeft:"8px"}})," ",e.timestamp?o()(e.timestamp).format("YYYY-MM-DD HH:mm:ss"):"N/A"," "]}),(0,n.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-all"},children:l(e.type,e.typeData)})]},e._id))})})]})},b=e=>{let{selectedDomain:r,selectedFingerprint:t,activeTab:n}=e,{eventList:i,userList:o,domainList:a}=(0,l.E)();return(0,s.useEffect)(()=>{let e="网站监测站";if(r)e="".concat(r," - 网站监测站");else if(t)e="用户 ".concat(t.slice(0,8),"... - 网站监测站");else if(n)switch(n){case"domains":e="域名列表 (".concat(a.length,") - 网站监测站");break;case"users":e="用户列表 (".concat(o.length,") - 网站监测站");break;case"events":e="事件时间线 (".concat(i.length,") - 网站监测站");break;default:e="网站监测站"}if(!r&&!t){let r=i.length;r>0&&(e="网站监测站 (".concat(r," 事件)"))}document.title=e},[r,t,n,i.length,o.length,a.length]),null};var j=t(9509);let v=()=>{let[e,r]=(0,s.useState)(null),{eventList:t,domainList:i,userList:o,detailList:a}=(0,l.E)(),[d,c]=(0,s.useState)(null),[x,u]=(0,s.useState)(null),[m,v]=(0,s.useState)(null),[C,k]=(0,s.useState)("domains"),[S,w]=(0,s.useState)(new Map),[N,R]=(0,s.useState)(new Map);(0,s.useEffect)(()=>{(async()=>{try{for(let e of["https://api.ipify.org?format=json","https://ipapi.co/json/","https://api.ip.sb/jsonip"])try{let t=new AbortController,n=setTimeout(()=>t.abort(),5e3),l=await fetch(e,{method:"GET",signal:t.signal});if(clearTimeout(n),l.ok){let e=await l.json(),t=e.ip||e.query||e.IPv4||e.address;if(t)return void r(t)}}catch(r){console.warn("Service ".concat(e," failed:"),r);continue}r("无法获取IP")}catch(e){console.error("Error fetching IP address:",e),r("获取IP失败")}})()},[]),(0,s.useEffect)(()=>{let e=new Map;t&&t.forEach(r=>{let t=r.domain;e.set(t,(e.get(t)||0)+1)}),w(e),"dev"===j.env.NEXT_PUBLIC_PROJECT_MODE&&console.log("[Page] Calculated domain event counts:",e)},[t]),(0,s.useEffect)(()=>{let e=new Map;t&&t.forEach(r=>{let t=r.domain;e.set(t,(e.get(t)||0)+1)}),w(e),"dev"===j.env.NEXT_PUBLIC_PROJECT_MODE&&console.log("[Page] Calculated domain event counts:",e)},[t]);let D=(0,s.useCallback)(e=>{u(e),v(e&&o.find(r=>r.fingerprint===e)||null)},[o]),E=(0,s.useCallback)((e,r)=>{R(t=>{let n=new Map(t);return n.set(e,r),n})},[]),z=(0,s.useMemo)(()=>x&&a?a.filter(e=>e.fingerprint===x):[],[a,x]),I=(0,s.useMemo)(()=>{let e=t;return x&&(e=e.filter(e=>e.fingerprint===x)),e},[t,x]);return(0,n.jsxs)("div",{className:"page-container",children:[(0,n.jsx)(b,{selectedDomain:d,selectedFingerprint:x,activeTab:C}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 20px",backgroundColor:"#ffffff",marginBottom:"20px",border:"1px solid var(--border-color)",borderRadius:"16px"},children:[(0,n.jsxs)("span",{style:{fontSize:"1.5em",fontWeight:"bold",marginRight:"20px"},children:[(0,n.jsx)("span",{style:{color:"var(--text-color)"},children:"Web Analysis"})," "]}),(0,n.jsxs)("span",{style:{fontSize:"1em",color:"var(--text-color)"},children:[" ","My IP: ",e||"Fetching..."]})]}),(0,n.jsxs)("div",{className:"main-layout",children:[(0,n.jsx)("div",{className:"left-column",children:(0,n.jsxs)("div",{className:"left-panels-container",style:{display:"flex",flexDirection:"column",gap:"20px"},children:[(0,n.jsxs)("div",{className:"panel panel-domain",children:[(0,n.jsxs)("h3",{style:{display:"flex",alignItems:"center",cursor:"pointer",color:"domains"===C?"var(--primary-color)":"var(--text-color)"},onClick:()=>k("domains"),children:[(0,n.jsx)(f.f35,{style:{marginRight:"8px"}}),"Domains"]}),(0,n.jsx)(p,{selectedDomain:d,onSelectDomain:c,domainEventCounts:S,domainOnlineUserCounts:N,domainList:i,userList:o,eventList:t})]}),(0,n.jsxs)("div",{className:"panel",children:[(0,n.jsxs)("h3",{style:{display:"flex",alignItems:"center",marginBottom:"15px",fontSize:"1.2em",borderBottom:"1px solid var(--panel-title-border-color)",paddingBottom:"10px",flexShrink:0,cursor:"pointer",color:"users"===C?"var(--primary-color)":"var(--text-color)"},onClick:()=>k("users"),children:[(0,n.jsx)(f.YXz,{style:{marginRight:"10px"}}),"Users"]}),(0,n.jsx)(g,{userList:o,selectedDomain:d,onSelectFingerprint:D,onOnlineUserCountChange:E})]})]})}),(0,n.jsx)("div",{className:"middle-column",children:(0,n.jsxs)("div",{className:"panel",children:[(0,n.jsxs)("h3",{style:{display:"flex",alignItems:"center",cursor:"pointer",color:"fingerprint"===C?"var(--primary-color)":"var(--text-color)"},onClick:()=>k("fingerprint"),children:[(0,n.jsx)(f.OIO,{style:{marginRight:"8px"}})," ","User Fingerprint"]}),x?(0,n.jsx)(h,{user:m,details:z}):(0,n.jsx)("p",{children:"请选择一个用户查看详情。"})]})}),(0,n.jsx)("div",{className:"right-column",children:(0,n.jsxs)("div",{className:"panel",style:{maxWidth:"800px"},children:[(0,n.jsxs)("h3",{style:{display:"flex",alignItems:"center",cursor:"pointer",color:"events"===C?"var(--primary-color)":"var(--text-color)"},onClick:()=>k("events"),children:[(0,n.jsx)(f.OKX,{style:{marginRight:"10px"}}),"Event Timeline"]}),x?(0,n.jsx)(y,{events:I}):(0,n.jsx)("p",{children:"请选择一个用户查看事件时间线。"})]})})]}),(0,n.jsx)("script",{src:"/tracker.js",async:!0})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[708,711,892,664,736,441,684,358],()=>r(8447)),_N_E=e.O()}]);